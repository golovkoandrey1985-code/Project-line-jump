# Line Jump - Техническая Документация MVP

**Версия:** 1.0.0 (MVP)  
**Дата:** 5 ноября 2025  
**Автор:** Manus AI

---

## Исполнительное Резюме

Данный документ представляет техническую документацию для MVP (Minimum Viable Product) гиперказуальной игры **"Line Jump"**, разработанной в соответствии с методологией data-driven development для гиперказуальных игр. Прототип реализует все ключевые элементы Фазы 1 согласно исходному плану разработки и готов к переходу в Фазу 2 (KPI-тестирование).

MVP представляет собой полнофункциональную веб-игру с механикой "прыжков между полосами", процедурной генерацией препятствий с гарантированным безопасным путем, системой подсчета очков и сохранением рекордов. Игра оптимизирована для мобильных устройств и десктопов, имеет яркий контрастный визуальный стиль в соответствии с принципами Flat Design для максимальной читаемости в видео-креативах.

---

## Архитектура и Технический Стек

### Технологический Стек

Проект построен на современном веб-стеке с акцентом на производительность и простоту развертывания:

- **Frontend Framework**: React 19 с TypeScript
- **Styling**: Tailwind CSS 4 + shadcn/ui компоненты
- **Рендеринг**: HTML5 Canvas API (2D Context)
- **Роутинг**: Wouter (легковесная альтернатива React Router)
- **Сборка**: Vite (быстрая разработка и оптимизированная сборка)
- **Хранение данных**: localStorage API (для сохранения highscore)

### Структура Проекта

```
line-jump-game/
├── client/
│   ├── public/              # Статические ресурсы
│   └── src/
│       ├── components/
│       │   └── Game.tsx     # Основной игровой компонент
│       ├── pages/
│       │   └── Home.tsx     # Домашняя страница (не используется в MVP)
│       ├── App.tsx          # Корневой компонент приложения
│       └── main.tsx         # Точка входа React
├── todo.md                  # Трекер задач и функций
└── DOCUMENTATION.md         # Данный документ
```

---

## Реализованные Функции (Фаза 1 - MVP)

### 1. Основная Механика Управления

#### 3-полосная Система Движения

Игра реализует дискретное перемещение между тремя фиксированными полосами. Позиции полос определены константой:

```typescript
const LANE_POSITIONS = [-200, 0, 200]; // Позиции в пикселях относительно центра
```

Игрок всегда находится на одной из трех полос (индексы 0, 1, 2), начиная с центральной полосы (индекс 1).

#### Управление "В Одно Касание"

Управление реализовано через обработку кликов и касаний экрана:

- **Клик/касание левой половины экрана** → перемещение влево (если возможно)
- **Клик/касание правой половины экрана** → перемещение вправо (если возможно)

Система предотвращает выход за границы игрового поля через проверку индекса полосы перед перемещением.

#### Плавное Движение с Easing

Перемещение между полосами реализовано с использованием **ease-out quadratic easing** для создания "сочного" (juicy) ощущения управления:

```typescript
const easeProgress = 1 - Math.pow(1 - progress, 2);
```

Параметры движения:
- **Длительность**: 100ms (`MOVE_DURATION`)
- **Функция сглаживания**: Ease-out quad (быстрый старт, плавное замедление)

Это обеспечивает отзывчивое и приятное управление, критически важное для гиперказуальных игр.

### 2. Визуальный Стиль (Flat Design)

#### Цветовая Палитра

Игра использует высококонтрастную цветовую схему, оптимизированную для видео-креативов:

| Элемент | Цвет | Назначение |
|---------|------|------------|
| Фон | `#0a0e27` | Темный фон для контраста |
| Полосы | `#1a1f3a` | Игровые дорожки |
| Игрок | `#00d9ff` (Cyan) | Яркий сигнальный цвет |
| Препятствия | `#ff3366` (Красный) | Контрастный цвет опасности |
| Разметка | `#ffd700` (Золотой) | Дорожная разметка |

#### Визуальные Эффекты

**Эффекты свечения (Glow)**: Игрок и препятствия имеют эффект свечения через `shadowBlur` Canvas API, что усиливает визуальную привлекательность и улучшает читаемость.

**Система частиц**: При столкновении создается эффект взрыва из частиц цвета игрока, обеспечивая визуальную обратную связь.

**Анимированная дорожная разметка**: Пунктирные линии на дороге анимируются через `lineDashOffset`, создавая иллюзию движения.

### 3. Процедурная Генерация Препятствий

#### Алгоритм "Гарантированного Безопасного Пути"

Реализован алгоритм **Limited Generation** из исходного плана, который гарантирует, что игрок всегда имеет хотя бы один безопасный путь:

**Шаг 1**: Выбирается случайная полоса как безопасная (0, 1 или 2)

**Шаг 2**: Препятствия создаются на всех остальных полосах

**Шаг 3**: С вероятностью 30% выбирается вторая безопасная полоса для снижения сложности

Это полностью исключает ситуации "непроходимых стен", которые могут разрушить игровой опыт.

#### Параметры Спауна

Текущие параметры балансировки:

- **Интервал спауна**: 2500ms (`SPAWN_INTERVAL`)
- **Начальная задержка**: 1500ms (`INITIAL_SPAWN_DELAY`)
- **Скорость препятствий**: 3 пикселя/кадр (`OBSTACLE_SPEED`)
- **Позиция спауна**: -120 пикселей выше верхней границы экрана

Эти значения обеспечивают комфортный игровой процесс для MVP и могут быть легко настроены для Фазы 3 (DDA).

### 4. Система Обнаружения Столкновений

Реализована **AABB (Axis-Aligned Bounding Box)** система столкновений, проверяющая пересечение прямоугольных хитбоксов игрока и препятствий:

```typescript
if (
  playerRight > obsLeft &&
  playerLeft < obsRight &&
  playerBottom > obsTop &&
  playerTop < obsBottom
) {
  // Столкновение обнаружено
}
```

Размеры хитбоксов:
- **Игрок**: 50x50 пикселей (круг, но проверка через AABB)
- **Препятствие**: 70x70 пикселей

### 5. Система Подсчета Очков

#### Time-Based Scoring

Счет начисляется на основе времени выживания:

```typescript
score = Math.floor(elapsedSeconds * 10)
```

Это дает **10 очков за секунду** выживания, обеспечивая понятную и предсказуемую прогрессию счета.

#### Сохранение Рекордов

Рекорд (highscore) сохраняется в `localStorage` под ключом `lineJumpHighScore` и автоматически загружается при запуске игры. Система сравнивает текущий счет с рекордом и обновляет его при превышении.

### 6. Управление Состояниями Игры

Игра имеет три состояния, управляемые через React state:

| Состояние | Описание | UI Элементы |
|-----------|----------|-------------|
| `menu` | Главное меню | Название, инструкции, кнопка "Играть", highscore |
| `playing` | Активная игра | Canvas с игрой, счетчик очков, подсказки управления |
| `gameOver` | Экран окончания | Финальный счет, highscore, кнопка "Играть снова" |

### 7. Оптимизация Производительности

#### Использование useRef для Игрового Состояния

Критически важные игровые данные (позиция игрока, препятствия, частицы) хранятся в `useRef`, а не в React state, чтобы избежать ненужных ре-рендеров компонента при каждом обновлении кадра.

#### Эффективный Game Loop

Игровой цикл реализован через `requestAnimationFrame`, обеспечивая синхронизацию с частотой обновления экрана (обычно 60 FPS) и автоматическую паузу при неактивной вкладке.

#### Очистка Ресурсов

При размонтировании компонента или смене состояния игры корректно отменяется `requestAnimationFrame`, предотвращая утечки памяти.

---

## Инструкции по Расширению до Полноценной Игры

### Фаза 2: Подготовка к KPI-Тестированию

#### Создание Build для Тестирования

Для создания production build выполните:

```bash
cd /home/ubuntu/line-jump-game
pnpm build
```

Готовые файлы будут в директории `client/dist/` и могут быть развернуты на любом статическом хостинге.

#### Подготовка Видео-Креативов

Для тестирования CPI необходимо создать 3-5 коротких видео (10-15 секунд):

**Требования к креативам**:
- Первые 3 секунды должны показывать самый интересный момент геймплея
- Высокий контраст и яркие цвета (уже реализовано в визуальном стиле)
- Чистый геймплей без UI элементов
- Демонстрация основной механики "прыжков"

**Рекомендуемые инструменты**: OBS Studio для записи экрана, Adobe Premiere / DaVinci Resolve для монтажа.

### Фаза 3: Динамическая Сложность (DDA)

После успешного прохождения KPI-тестов (CPI < $0.30, D1 > 38%) необходимо внедрить систему динамического увеличения сложности.

#### Реализация DifficultyManager

Создайте отдельный хук или менеджер для управления сложностью:

```typescript
// Добавить в Game.tsx
const difficultyRef = useRef({
  timeScale: 1.0,
  spawnInterval: SPAWN_INTERVAL,
});

// В gameLoop добавить:
const elapsedTime = (currentTime - gameStartTimeRef.current) / 1000;

// Увеличение скорости игры (до 2x за 60 секунд)
difficultyRef.current.timeScale = Math.min(1.0 + elapsedTime * 0.015, 2.0);

// Уменьшение интервала спауна (до 1000ms минимум)
difficultyRef.current.spawnInterval = Math.max(
  SPAWN_INTERVAL - elapsedTime * 20,
  1000
);
```

#### Применение timeScale

Для корректной работы DDA необходимо умножать скорость препятствий на `timeScale`:

```typescript
// В updateObstacles:
obstaclesRef.current = obstaclesRef.current
  .map(obs => ({ 
    ...obs, 
    y: obs.y + OBSTACLE_SPEED * difficultyRef.current.timeScale 
  }))
```

**Важно**: Движение игрока должно оставаться независимым от `timeScale` для сохранения отзывчивости управления.

### Фаза 4: Мета-Игра и Монетизация

#### Система Постоянных Улучшений

Добавьте систему множителя очков, которая сохраняется между сессиями:

```typescript
// В ScoreManager
const scoreMultiplier = parseFloat(
  localStorage.getItem('scoreMultiplier') || '1.0'
);

// При начислении очков
score += (scorePerSecond * scoreMultiplier) * deltaTime;
```

#### Магазин Улучшений

Создайте компонент `Shop.tsx` с возможностью покупки улучшений:

```typescript
interface Upgrade {
  level: number;
  cost: number;
  multiplier: number;
}

// Экспоненциальный рост стоимости
const getUpgradeCost = (level: number) => {
  return Math.floor(100 * Math.pow(1.5, level));
};
```

#### Интеграция Вознаграждаемой Рекламы

Для монетизации рекомендуется интегрировать **Google AdMob** или **Unity Ads**:

**Размещение**: Экран Game Over с предложением "Удвоить монеты"

**Реализация**:
1. Добавить SDK рекламной сети в проект
2. Создать `AdsManager` для управления показом рекламы
3. На экране Game Over добавить две кнопки:
   - "Смотреть рекламу (Получить {score * 2})" - яркая кнопка
   - "Продолжить (Получить {score})" - обычная кнопка

**Важно**: Реклама должна быть opt-in (добровольной) и не прерывать игровой процесс.

---

## Константы и Параметры Балансировки

Все ключевые параметры игры вынесены в константы в начале файла `Game.tsx` для удобной настройки:

| Константа | Значение | Описание | Рекомендации по изменению |
|-----------|----------|----------|---------------------------|
| `LANE_POSITIONS` | `[-200, 0, 200]` | Позиции полос | Не изменять без переработки визуала |
| `PLAYER_SIZE` | `50` | Размер игрока | Уменьшить для увеличения сложности |
| `OBSTACLE_WIDTH` | `70` | Ширина препятствия | Изменить вместе с PLAYER_SIZE |
| `OBSTACLE_HEIGHT` | `70` | Высота препятствия | Влияет на визуальный стиль |
| `MOVE_DURATION` | `100` | Время перемещения (мс) | Не изменять - оптимально для отзывчивости |
| `SPAWN_INTERVAL` | `2500` | Интервал спауна (мс) | Уменьшить для увеличения сложности |
| `OBSTACLE_SPEED` | `3` | Скорость препятствий | Увеличить для DDA в Фазе 3 |
| `INITIAL_SPAWN_DELAY` | `1500` | Задержка перед первым спауном | Дать игроку время освоиться |

---

## Известные Ограничения и Будущие Улучшения

### Текущие Ограничения MVP

**Отсутствие звуковых эффектов**: MVP не включает аудио, так как это не критично для тестирования CPI и D1 retention. Звуки должны быть добавлены в Фазе 3.

**Фиксированная сложность**: Сложность не увеличивается со временем, что может привести к монотонности при длительной игре. Решается внедрением DDA в Фазе 3.

**Отсутствие мета-игры**: Нет долгосрочной мотивации для возвращения в игру. Решается добавлением системы улучшений в Фазе 4.

**Только веб-версия**: Для максимального охвата необходимо создать нативные сборки для iOS и Android.

### Рекомендуемые Улучшения

#### Для Фазы 3 (После Валидации KPI)

**Звуковые эффекты**:
- Звук перемещения между полосами (короткий "swoosh")
- Звук столкновения (резкий "crash")
- Фоновая музыка (опционально, может отвлекать)

**Визуальные улучшения**:
- Анимация "сжатия" игрока при перемещении (squash & stretch)
- Trail effect за игроком
- Более разнообразные формы препятствий
- Смена цветовой схемы каждые 100 очков

**Геймплейные улучшения**:
- Бонусные объекты (монеты, звезды) для дополнительных очков
- Power-ups (щит, замедление времени)
- Разные типы препятствий (статичные, движущиеся)

#### Для Фазы 4 (Мета-игра)

**Система прогрессии**:
- Разблокируемые скины для игрока
- Разные темы оформления (космос, океан, город)
- Достижения и миссии
- Таблица лидеров (требует backend)

**Монетизация**:
- Вознаграждаемая реклама (удвоение монет)
- Межуровневая реклама (каждые 3-5 игр)
- IAP для удаления рекламы
- IAP для покупки валюты

---

## Развертывание и Публикация

### Локальная Разработка

```bash
cd /home/ubuntu/line-jump-game
pnpm install
pnpm dev
```

Игра будет доступна на `http://localhost:3000`

### Production Build

```bash
pnpm build
```

Оптимизированные файлы будут в `client/dist/`

### Развертывание

Проект можно развернуть на любом статическом хостинге:

- **Vercel**: `vercel deploy`
- **Netlify**: Drag & drop папки `client/dist`
- **GitHub Pages**: Настроить GitHub Actions для автоматической сборки
- **Manus Platform**: Использовать встроенную кнопку "Publish" в UI

### Создание Мобильных Версий

Для создания нативных приложений рекомендуется использовать:

**Capacitor** (рекомендуется):
```bash
npm install @capacitor/core @capacitor/cli
npx cap init
npx cap add ios
npx cap add android
```

**Cordova** (альтернатива):
```bash
npm install -g cordova
cordova create lineJump com.yourdomain.linejump LineJump
```

---

## Метрики Успеха и KPI

### Целевые Показатели для Фазы 2

Согласно исходному плану, проект должен достичь следующих метрик для перехода к полной разработке:

| Метрика | Целевое Значение | Статус |
|---------|------------------|--------|
| **CPI (Cost Per Install)** | < $0.30 | Требует тестирования |
| **D1 Retention** | > 38% | Требует тестирования |
| **Session Length** | 3-5 минут | Достижимо в MVP |
| **Crash Rate** | < 1% | Требует мониторинга |

### Инструменты Аналитики

Для отслеживания метрик рекомендуется интегрировать:

- **Google Analytics 4**: Для веб-версии
- **Firebase Analytics**: Для мобильных версий
- **Adjust / AppsFlyer**: Для attribution tracking и измерения CPI

---

## Заключение

MVP прототип **Line Jump** полностью реализует все требования Фазы 1 согласно исходному плану разработки гиперказуальной игры. Проект готов к переходу в Фазу 2 (KPI-тестирование) и имеет четкую архитектуру для последующего расширения функционала в Фазах 3 и 4.

Ключевые достижения MVP:
- ✅ Отзывчивое управление "в одно касание" с плавной анимацией
- ✅ Яркий контрастный визуальный стиль для видео-креативов
- ✅ Процедурная генерация с гарантированным безопасным путем
- ✅ Система подсчета очков и сохранения рекордов
- ✅ Оптимизация для мобильных устройств
- ✅ Модульная архитектура для легкого расширения

Проект следует методологии "Fail Fast" и готов к быстрой итерации на основе реальных данных пользователей.

---

**Документ подготовлен**: Manus AI  
**Версия документа**: 1.0.0  
**Дата последнего обновления**: 5 ноября 2025
